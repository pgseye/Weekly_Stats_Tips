quarto add jmgirard/embedpdf
library(flextable)
#| label: emmeans
emmeans(mod_interact, ~ sex + age, type = "response") |>
data.frame() |>
flextable() |>
colformat_double(digits = 2, na_str = "N/A") |>
set_table_properties(layout = "autofit") |>
height(height = 1, unit = "cm") |>
hrule(rule = "atleast", part = "header") |>
align(align = "center", part = "body") |>
flextable::font(fontname = "Consolas", part = "all") |>
theme_vanilla()
#| label: setup
library(knitr)
library(quarto)
library(emmeans)
library(gtsummary)
library(flextable)
opts_chunk$set(echo = T,
cache = F,
prompt = F,
tidy = F,
comment = NA,
message = F,
warning = F)
#| label: aggregated data
dat_agg <- data.frame(sex = c("Male", "Female"),
hospitalised = as.numeric(c(1330, 798)),
not_hospitalised = as.numeric(c(7018,6400)))
dat_agg
#| label: crude model
mod_crude <- glm(cbind(hospitalised, not_hospitalised) ~ sex, data = dat_agg, family = binomial(link = "log"))
tbl_regression(mod_crude,
exp = T)
#| label: disaggregated data
dat_disagg <- data.frame(sex = c("Male", "Female", "Male", "Female"),
age = c("< 40", "< 40", "≥ 40", "≥ 40"),
hospitalised = as.numeric(c(966, 460, 364, 348)),
not_hospitalised = as.numeric(c(3146, 3000, 3872, 3400)))
dat_disagg
#| label: adjusted model confounding
mod_confound <- glm(cbind(hospitalised, not_hospitalised) ~ sex + age, data = dat_disagg, family = binomial(link = "log"))
tbl_regression(mod_confound,
exp = T)
#| label: adjusted model effect modification
mod_interact <- glm(cbind(hospitalised, not_hospitalised) ~ sex * age, data = dat_disagg, family = binomial(link = "log"))
tbl_regression(mod_interact,
exp = T)
#| label: emmeans
emmeans(mod_interact, ~ sex + age, type = "response") |>
data.frame() |>
flextable() |>
colformat_double(digits = 2, na_str = "N/A") |>
set_table_properties(layout = "autofit") |>
height(height = 1, unit = "cm") |>
hrule(rule = "atleast", part = "header") |>
align(align = "center", part = "body") |>
flextable::font(fontname = "Consolas", part = "all") |>
theme_vanilla()
#| label: emmeans
emmeans(mod_interact, ~ sex + age, type = "response") |>
data.frame() |>
flextable() |>
colformat_double(digits = 3, na_str = "N/A") |>
set_table_properties(layout = "autofit") |>
height(height = 1, unit = "cm") |>
hrule(rule = "atleast", part = "header") |>
align(align = "center", part = "body") |>
flextable::font(fontname = "Consolas", part = "all") |>
theme_vanilla()
#| label: risk ratios
emmeans(mod_interact, ~ sex + age, type = "response") |> pairs(rev = T) |>
data.frame() |>
flextable() |>
colformat_double(digits = 3, na_str = "N/A") |>
set_table_properties(layout = "autofit") |>
height(height = 1, unit = "cm") |>
hrule(rule = "atleast", part = "header") |>
align(align = "center", part = "body") |>
flextable::font(fontname = "Consolas", part = "all") |>
theme_vanilla()
#| label: risk ratios custom
emm <- emmeans(mod_interact, ~ sex + age, type = "response") # save the estimated risks
custom <- list(`The effect of being male in younger individuals` = c(-1,1,0,0),
`The effect of being male in older individuals` = c(0,0,-1,1),
`The effect of being older in females` = c(-1,0,1,0),
`The effect of being older in males` = c(0,-1,0,1)) # create custom grid of RR's to estimate
contrast(emm, custom) |>
summary(infer = T) |>
data.frame() |>
flextable() |>
colformat_double(digits = 3, na_str = "N/A") |>
set_table_properties(layout = "autofit") |>
height(height = 1, unit = "cm") |>
hrule(rule = "atleast", part = "header") |>
align(align = "center", part = "body") |>
flextable::font(fontname = "Consolas", part = "all") |>
theme_vanilla()
#| label: risk ratios
#| tbl-cap: All Pairwise Risk Ratios
emmeans(mod_interact, ~ sex + age, type = "response") |> pairs(rev = T) |>
data.frame() |>
flextable() |>
colformat_double(digits = 3, na_str = "N/A") |>
set_table_properties(layout = "autofit") |>
height(height = 1, unit = "cm") |>
hrule(rule = "atleast", part = "header") |>
align(align = "center", part = "body") |>
flextable::font(fontname = "Consolas", part = "all") |>
theme_vanilla()
emmeans(mod_interact, ~ sex + age, type = "response") |> pairs(rev = T) |>
data.frame() |>
flextable() |>
colformat_double(digits = 3, na_str = "N/A") |>
set_table_properties(layout = "autofit") |>
height(height = 1, unit = "cm") |>
hrule(rule = "atleast", part = "header") |>
align(align = "center", part = "body") |>
flextable::font(fontname = "Consolas", part = "all") |>
theme_vanilla()
emmeans(mod_interact, ~ sex + age, type = "response") |> pairs(rev = T) |>
data.frame()
emmeans(mod_interact, ~ sex + age, type = "response") |> pairs(rev = T) |>
data.frame() |>
flextable()
